# src/ ディレクトリ構成と設計方針

本プロジェクトでは、**関心の分離（Separation of Concerns）** と  
**依存関係の明示的管理** を重視したディレクトリ構成を採用しています。

---

## ディレクトリ構成
src/
├─ errors/
├─ middleware/
├─ repositories/
├─ types/
├─ utils/
└─ features/


## 共通レイヤ（横断的関心事）

### errors/
アプリケーション全体で使用する **エラー定義** を集約します。

**役割**
- 認証・認可エラー
- ログイン時のエラー
- DB 制約違反（FK違反、ユニーク制約違反など）
- HTTP レスポンス変換を前提としたドメインエラー

---

### middleware/
Express ミドルウェアを管理します。

**役割**
- 認証・認可（JWT / Role）
- リクエスト・レスポンスのログ収集
- サーバーサイドのバリデーション
- 共通的な前処理・後処理

---

### repositories/
DB アクセスに関する **共通基盤** を提供します。

**役割**
- トランザクション用インスタンスの生成
- ORM / QueryBuilder のラッパー
- 複雑なクエリ処理や共通 CRUD 操作

---

### types/
共通の型定義・インターフェース定義を配置します。

**役割**
- 型エイリアス
- DTO / Interface
- Express 拡張型（例: `Request.user`）

---

### utils/
汎用関数や **service 層で使うユーティリティ関数** をまとめます。

**役割**
- ログ処理
- 認証・認可補助
- 日付・文字列などの共通ユーティリティ

---

## features/
各機能ごとにモジュール単位でまとめます。  
features/
├─ featureA/
│ ├─ controller.ts
│ ├─ service.ts
│ ├─ repository.ts
│ ├─ routes.ts
│ └─ module.ts

**役割**
- controller: ルーティングされたリクエストを受け取り、service 層を呼び出す
- service: ビジネスロジックを実装し、必要に応じて repository を呼び出す
- repository: DB への CRUD 操作を担当
- routes: エンドポイントのルーティングを定義
- module: 依存関係を注入（DI）するための設定をまとめる
