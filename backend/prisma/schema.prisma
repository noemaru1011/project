generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Category {
  categoryId    Int @id @default(autoincrement())
  categoryName  String        @db.VarChar(10)@unique
  subCategories SubCategory[]
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
}

model SubCategory {
  subCategoryId  Int @id @default(autoincrement())
  subCategoryName String        @db.VarChar(10)@unique
  categoryId      Int
  category        Category      @relation(fields: [categoryId], references: [categoryId])
  minorCategories MinorCategory[]
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
}

model MinorCategory {
  minorCategoryId   Int @id @default(autoincrement())
  minorCategoryName String        @db.VarChar(10)@unique
  subCategoryId     Int
  subCategory       SubCategory   @relation(fields: [subCategoryId], references: [subCategoryId])
  students          Student[]
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
}

model Department {
  departmentId   Int @id @default(autoincrement())
  departmentName String        @db.VarChar(30)@unique
  students       Student[]
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
}

model Status {
  statusId      Int @id @default(autoincrement())
  statusName    String @db.VarChar(10)@unique
  histories     History[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt 
}

model Student {
  studentId       String @id @default(uuid())
  minorCategoryId Int
  minorCategory   MinorCategory @relation(fields: [minorCategoryId], references: [minorCategoryId])
  departmentId    Int
  department      Department    @relation(fields: [departmentId], references: [departmentId])
  studentName     String
  password        StudentPassword?
  grade           Int  
  email           String @db.VarChar(255)@unique  
  histories       History[]
  deleteFlag      Boolean @default(false)
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
}

model StudentPassword{
  studentId     String@id
  student           Student @relation(fields: [studentId], references: [studentId])
  password          String@db.VarChar(255)
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
}

model History {
  historyId       String @id @default(uuid())
  studentId       String
  student         Student   @relation(fields: [studentId], references: [studentId])
  statusId        Int
  status          Status       @relation(fields: [statusId], references: [statusId])
  other           String?@db.VarChar(30)
  startTime       DateTime
  endTime         DateTime?
  validFlag       Boolean      @default(true)
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
}

model Admin {
  adminId        String @id @default(uuid())
  email          String @db.VarChar(255) @unique
  password       String @db.VarChar(255)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}
